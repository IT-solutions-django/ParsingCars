{% load custom_filters %}
<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
    <title>{{ title }}</title>





    <meta charset="utf-8" />

    <meta name="keywprds" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <!-- Odometr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/themes/odometer-theme-car.min.css" integrity="sha512-vpFf+ShbNFLKa6naBlMZXTroLsrJkFrUvyczr/OyFymcijnHczI/35t6C0y7PrwehYR/RDQ5MHNP/Msp+mWuKA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="text/javascript" src="/static/vendor/odometr.js" ></script>
    <script src="/static/vendor/jquery.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="text/javascript" src="/static/vendor/bootstrap.js"></script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        ym(98661400, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/98661400" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->



    <!-- Шрифты -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">

    <!-- Slider-swiper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/js/swiper.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/css/swiper.min.css" rel="stylesheet" />

    <!-- Стили -->
    <link type="text/css" href="/static/css/min_css/normolize.css" rel="stylesheet" />
    <link type="text/css" href="/static/icomoon/style.css" rel="stylesheet" />
    <link type="text/css" href="/static/css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/catalog.css">
    <link rel="stylesheet" href="/static/css/car.css">

    <!-- Adaptive -->
    <link rel="stylesheet" href="/static/css/media-base.css">
    <link rel="stylesheet" href="/static/css/media-main.css">
    <link rel="stylesheet" href="/static/css/media-catalog.css">
    <link rel="stylesheet" href="/static/css/media-car.css">

    <!-- AdaptiveJS -->
    <link href="/static/js/min_js/adptive.js">



    <script>
        const setModalInput = (text) => {
            document.querySelector(".modal textarea").value = text;
        };
    </script>

</head>

<header class="header header-visible">
    <div class="container">
        <div class="header__inner">

            <div class="header__menu">
                <a href="{% url 'catalog:encar' %}" class="header__menu-link">Encar</a>
                <a href="{% url 'catalog:autohub' %}" class="header__menu-link">AutoHub</a>
                <a href="{% url 'catalog:kcar' %}" class="header__menu-link">Kcar</a>
                <a href="{% url 'catalog:mpark' %}" class="header__menu-link">Mpark</a>
                <a href="{% url 'catalog:bobaedream' %}" class="header__menu-link">Bobaedream</a>
                <a href="{% url 'catalog:charancha' %}" class="header__menu-link">Charancha</a>

            </div>
            <div class="header__contacts">
                <div class="header__contacts-left">
                    <a href="tel:+7 111 111-11-11" target="_blank" class="header__contacts-tel">+7 111 111-11-11</a><br>
                    <a href="tel:+7 222 222-22-22" target="_blank" class="header__contacts-tel">+7 222 222-22-22</a>
                </div>
                <div class="header__contacts-right">






















                </div>
            </div>
            <button class="header__burger-btn">
                <img class="header__burger-btn--img" src="/static/img/burger-menu.svg" alt="Меню" srcset="">
            </button>
        </div>
        <div class="header__inner-mobile">
            <div class="header__inner-mobile--top">
                <div class="header__contacts-right header__contacts-right-mobile">

                </div>
                <a href="tel:+7 111 111-11-11" target="_blank" class="header__contacts-tel header__contacts-tel--mobile">+7 111 111-11-11</a>
                <a href="tel:+7 222 222-22-22" target="_blank" class="header__contacts-tel header__contacts-tel--mobile">+7 222 222-22-22</a>
            </div>
            <hr color="#FFFFFF79" size="2px" style="height: 1px; background-color: #FFFFFF79;" >
            <div class="header__inner-mobile--bottom">
                <a href="/japan" class="header__menu-link header__menu-link-mobile">Авто из Японии</a>
                <a href="/china" class="header__menu-link header__menu-link-mobile">Авто из Китая</a>
                <a href="/korea" class="header__menu-link header__menu-link-mobile">Авто из Кореи</a>

            </div>
        </div>
    </div>
</header>

<body style="padding-top: 0;">



<section class="catalog">
    <div class="container">
        <div class="bread">
            <ul class="mx-0 px-0" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
                <a itemprop="item" href="/"><span itemprop="name">Главная</span></a>
                <span><svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'><path d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='#9f9f9f'/></svg></span>
              </li>

                <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
                <a itemprop="item" href="{{ request.path }}"><span itemprop="name">Автомобили из {{ title }}</span></a>
                </li>

            </ul>
          </div>
        <div class="catalog__inner">
            <h3 class="catalog__title">Каталог авто из {{ title }}</h3>
            <div class="catalog__filter-mobile">
                <div class="row">
                    <div class="col-2">
                        <div class="sort-mobile-filter">
                            <div class="dropdown " id="sort-dropdown-mobile">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-sort-mobile" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <img src="/static/img/ordering.svg" alt="ordering" style="width: 20px; height: 20px;">
                                </button>
                                <ul class="dropdown-menu" style="width: 300px;">

                                        <li><button type="button" onclick="setField('sort', '', 'Без сортировки')" class="dropdown-item" href="#">Без сортировки</button></li>

                                            <li><hr class="dropdown-divider" ></li>


                                        <li><button type="button" onclick="setField('sort', 'new', 'Сначала новые')" class="dropdown-item" href="#">Сначала новые</button></li>


                                        <li><button type="button" onclick="setField('sort', 'old', 'Сначала старые')" class="dropdown-item" href="#">Сначала старые</button></li>


                                        <li><button type="button" onclick="setField('sort', 'low_eng_v', 'Сначала с низким объемом')" class="dropdown-item" href="#">Сначала с низким объемом</button></li>


                                        <li><button type="button" onclick="setField('sort', 'high_eng_v', 'Сначала с высоким объемом')" class="dropdown-item" href="#">Сначала с высоким объемом</button></li>


                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <button class="catalog__filter-parametrs">
                            <img src="/static/img/parametr.svg" alt="Параметры" srcset="">
                            <p class="catalog__filter-parametrs--text">Параметры</p>
                            <p class="catalog__filter-parametrs--count"></p>
                        </button>
                    </div>

                </div>

            </div>
            <form class="filter" id="filter-form">
                <div class="catalog-filter">
                    <div class="catalog-filter-header">
                        <button class="catalog-filter-header--close" type="button">
                            <img src="/static/img/close.svg" alt="Закрыть фильтры" srcset="">
                        </button>
                        <h2 class="catalog-filter-title">Параметры</h2>

                        <a class="catalog-filter-header--reset" href="/japan">
                            <img src="/static/img/reset.svg" alt="Сбросить фильтры" srcset="">
                        </a>




                    </div>
                    <div class="catalog__filter-main">
                        <div class="dropdown catalog__filter-select" id="brand-dropdown">
                            <input class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" autocomplete="off" id="brand-input" type="text" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Марка авто">
                            <img src="/static/img/arrow.svg" alt="" class="drop-input-arrow">
                            <ul class="dropdown-menu">

                                    <li><button type="button" onclick="setField('brand', '', 'Любая')" class="dropdown-item" href="#">Любая</button></li>

                                        <li><hr class="dropdown-divider"></li>

                                        {% for value, label in form.fields.brand.choices %}
                                        <li><button type="button" onclick="setField('brand', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                        {% endfor %}



                            </ul>
                            {{ form.brand }}
                        </div>
                        <div class="dropdown catalog__filter-select" id="model-dropdown">
                            <input class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" autocomplete="off" id = "btn-model" type="text" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Модель авто">
                            <img src="/static/img/arrow.svg" alt="" class="drop-input-arrow">
                            <ul class="dropdown-menu">

                            </ul>
                            <select name="model" class="form-control hidden-select" id="id_model">
</select>
                        </div>
                        <div class="catalog__filter-double-input catalog__filter--margin">
                            <div class="dropdown catalog__filter-select catalog__filter-select--nomargin" id="millage_min-dropdown">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-mileage1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% with request.GET.millage_min as millage_min %}
                                    {% if millage_min %}
                                    {{ millage_min }}
                                    {% else %}
                                    Пробег от,км
                                    {% endif %}
                                    {% endwith %}


                                </button>
                                <ul class="dropdown-menu">

                                        <li><button type="button" onclick="setField('millage_min', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                            <li><hr class="dropdown-divider" ></li>
                                            {% for value, label in form.fields.millage_min.choices %}
                                        <li><button type="button" onclick="setField('millage_min', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                            {% endfor %}




                                </ul>
                                {{ form.millage_min }}
                            </div>
                            <div class="dropdown catalog__filter-select catalog__filter-select--nomargin" id="millage_max-dropdown">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-mileage2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% with request.GET.millage_max as millage_max %}
                                    {% if millage_max %}
                                    {{ millage_max }}
                                    {% else %}
                                    до
                                    {% endif %}
                                    {% endwith %}


                                </button>
                                <ul class="dropdown-menu">

                                        <li><button type="button" onclick="setField('millage_max', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                            <li><hr class="dropdown-divider" ></li>

                                        {% for value, label in form.fields.millage_max.choices %}
                                        <li><button type="button" onclick="setField('millage_max', '{{value}}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                        {% endfor %}




                                </ul>
                                {{ form.millage_max }}
                            </div>
                        </div>
                        <div class="dropdown catalog__filter-select " id="fuel_type-dropdown">
                            <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-fuel_type" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {% with request.GET.fuel_type as fuel_type %}
                                {% for code, name in form.fields.fuel_type.choices %}
                                {% if code == fuel_type %}
                                {{ name }}
                                {% endif %}
                                {% endfor %}
                                {% if not fuel_type %}Тип двигателя{% endif %}
                                {% endwith %}

                            </button>
                            <ul class="dropdown-menu">

                                    <li><button type="button" onclick="setField('fuel_type', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                        <li><hr class="dropdown-divider" ></li>

                                        {% for value, label in form.fields.fuel_type.choices %}
                                        <li><button type="button" onclick="setField('fuel_type', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                        {% endfor %}



                            </ul>
                            {{ form.fuel_type }}
                        </div>
                        <div class="catalog__filter-double-input catalog__filter--margin   ">
                            <div class="dropdown catalog__filter-select catalog__filter-select--nomargin" id="year_min-dropdown">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-year1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% with request.GET.year_min as year_min %}
                                    {% if year_min %}
                                    {{ year_min }}
                                    {% else %}
                                    Год от
                                    {% endif %}
                                    {% endwith %}
                                </button>
                                <ul class="dropdown-menu">

                                        <li><button type="button" onclick="setField('year_min', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                            <li><hr class="dropdown-divider" ></li>
                                            {% for value, label in form.fields.year_min.choices %}
                                            <li><button type="button" onclick="setField('year_min', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                            {% endfor %}



                                </ul>
                                {{ form.year_min }}
                            </div>
                            <div class="dropdown catalog__filter-select catalog__filter-select--nomargin" id="year_max-dropdown">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-year2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% with request.GET.year_max as year_max %}
                                    {% if year_max %}
                                    {{ year_max }}
                                    {% else %}
                                    до
                                    {% endif %}
                                    {% endwith %}
                                </button>
                                <ul class="dropdown-menu">

                                        <li><button type="button" onclick="setField('year_max', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                            <li><hr class="dropdown-divider" ></li>

                                            {% for value, label in form.fields.year_max.choices %}
                                            <li><button type="button" onclick="setField('year_max', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                            {% endfor %}



                                </ul>
                                {{ form.year_max }}
                            </div>
                        </div>
                        <div class="catalog__filter-double-input">
                            <div class="dropdown catalog__filter-select" id="engine_volume_min-dropdown">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-volume" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% with request.GET.engine_volume_max as engine_volume_max %}
                                    {% if engine_volume_max %}
                                    {{ engine_volume_max|divide:1000 }}
                                    {% else %}
                                    Объем от, л
                                    {% endif %}
                                    {% endwith %}
                                </button>
                                <ul class="dropdown-menu">

                                        <li><button type="button" onclick="setField('engine_volume_min', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                            <li><hr class="dropdown-divider" ></li>

                                            {% for value, label in form.fields.engine_volume_min.choices %}
                                            <li><button type="button" onclick="setField('engine_volume_min', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                            {% endfor %}



                                </ul>
                                {{ form.engine_volume_min }}
                            </div>
                            <div class="dropdown catalog__filter-select" id="engine_volume_max-dropdown">
                                <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-volume2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    {% with request.GET.engine_volume_max as engine_volume_max %}
                                    {% if engine_volume_max %}
                                    {{ engine_volume_max|divide:1000 }}
                                    {% else %}
                                    до
                                    {% endif %}
                                    {% endwith %}
                                </button>
                                <ul class="dropdown-menu">

                                        <li><button type="button" onclick="setField('engine_volume_max', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                            <li><hr class="dropdown-divider" ></li>

                                            {% for value, label in form.fields.engine_volume_max.choices %}
                                            <li><button type="button" onclick="setField('engine_volume_max', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                            {% endfor %}



                                </ul>
                                {{ form.engine_volume_max }}
                            </div>
                        </div>
                        <div class="dropdown catalog__filter-select catalog__filter--margin" id="transmission-dropdown">
                            <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-transmission" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {% with request.GET.transmission as transmission %}
                                {% for code, name in form.fields.transmission.choices %}
                                {% if code == transmission %}
                                {{ name }}
                                {% endif %}
                                {% endfor %}
                                {% if not transmission %}Тип КПП{% endif %}
                                {% endwith %}
                            </button>
                            <ul class="dropdown-menu">

                                    <li><button type="button" onclick="setField('transmission', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                        <li><hr class="dropdown-divider" ></li>

                                        {% for value, label in form.fields.transmission.choices %}
                                        <li><button type="button" onclick="setField('transmission', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                        {% endfor %}




                            </ul>
                            {{ form.transmission }}
                        </div>
                        <div class="dropdown catalog__filter-select" id="color-dropdown">
                            <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-color"type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {% with request.GET.color as color %}
                                {% if color %}
                                {{ color }}
                                {% else %}
                                Цвет
                                {% endif %}
                                {% endwith %}
                            </button>
                            <ul class="dropdown-menu">

                                    <li><button type="button" onclick="setField('color', '', 'Любой')" class="dropdown-item" href="#">Любой</button></li>

                                        <li><hr class="dropdown-divider" ></li>

                                        {% for value, label in form.fields.color.choices %}
                                        <li><button type="button" onclick="setField('color', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                        {% endfor %}



                            </ul>
                            {{ form.color }}
                        </div>
                    </div>
                    <button class="catalog__filter-btn">Показать</button>
                    <a class="catalog__filter-btn--blue"  href="{% url 'catalog:encar' %}" style="display: inline-block;">Сбросить </a>
                </div>

                <div class="sort-filter">
                    <div class="dropdown catalog__filter-select " id="sort-dropdown">
                        <button class="btn btn-secondary dropdown-toggle catalog__filter-select--btn" id="btn-sort" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            {% with request.GET.sort as sort %}
                            {% for code, name in form.fields.sort.choices %}
                            {% if code == sort %}
                            {{ name }}
                            {% endif %}
                            {% endfor %}
                            {% if not sort %}Сортировка{% endif %}
                            {% endwith %}
                        </button>
                                <ul class="dropdown-menu" style="width: 300px;">

                                        <li><button type="button" onclick="setField('sort', '', 'Без сортировки')" class="dropdown-item" href="#">Без сортировки</button></li>

                                            <li><hr class="dropdown-divider" ></li>

                                            {% for value, label in form.fields.sort.choices %}
                                            <li><button type="button" onclick="setField('sort', '{{ value }}', '{{ label }}')" class="dropdown-item" href="#">{{ label }}</button></li>
                                            {% endfor %}



                                </ul>
                                {{ form.sort }}
                    </div>
                </div>

            </form>


            <div class="catalog__content">
                <div class="catalog__items">
                        {% for car in page_cars %}
                        <div class="catalog__item">

                            <a class="catalog__item-img--box" href="

                                {% url 'catalog:car' car.id %}
                            ">


                                <img src="{{ car.first_photo }}" alt="{{ car.marka_name }} {{ car.model_name }}" class="catalog__item-img">




                            </a>
                            <div class="catalog__item-content">
                                <a class="catalog__item-img--box" href="
                                {% url 'catalog:car' car.id %}
                            ">
                                <h3 class="catalog__item-title">{{ car.marka_name }} {{ car.model_name }}</h3>
                                <p class="catalog__item-suptext">
                                    {{ car.year }}
                                    {% if car.mileage %}
                                    •
                                    {{ car.mileage|format_number }} km
                                    {% endif %}








                                        {% if car.eng_v %}• {{ car.eng_v|format_number }} cc {% endif %}






                                    <span class="catalog__item-count">
                                        {% if car.calc_price %}
                                        {{ car.calc_price|format_number }} ₽
                                        {% else %}
                                        Уточнить цену
                                        {% endif %}
                                    </span>
                                </p>
                            </a>
                                <button href="/" class="catalog__item-btn" onclick="setModalInput('Я заинтересовался автомобилем {{ car.marka_name }} {{ car.model_name }} {{ car.year }}')" data-bs-toggle="modal" data-bs-target="#exampleModal">Оставить заявку</button>
                            </div>
                        </div>
                    {% endfor %}





                </div>
                <div class="catalog__content-bottom">
                    <div class="catalog__content-paginator">
                        {% if page_cars.has_previous %}

					<a href="?page={{ page_cars.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Назад</a>
				{% endif %}

		{% if page_cars.number > 3 %}
                        <a href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">1</a>
            <span>...</span>
        {% endif %}
		{% for num in page_cars.paginator.page_range %}
            {% if num > page_cars.number|add:-3 and num < page_cars.number|add:3 %}
                <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="{% if num == page_cars.number %}current-page{% endif %}">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {% if page_cars.number < page_cars.paginator.num_pages|add:-2 %}
            <span>...</span>
        {% endif %}

        {% if page_cars.has_next %}
            <a href="?page={{ page_cars.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Следующая</a>
            <a href="?page={{ page_cars.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ page_cars.paginator.num_pages }}</a>
        {% endif %}


































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                    </div>
                </div>
            </div>

        </div>
    </div>

</section>

<script>
    let country;

    country = 'japan';

    console.log(country)
    let fetchModels = (brand) => {
    // Возвращаем новый промис из функции fetchModels
    return new Promise((resolve, reject) => {
        var modelDropdown = document.getElementById('btn-model')
        var currentModelButton = document.querySelector('#model-dropdown > .btn');
        const url = new URL(window.location.href);
        var currentModelValue = url ? url.searchParams.get('model') : '';
        const data = {
            name: brand,
            country: country,

        };

        // Очистка старых элементов dropdownMenu
        const dropdownMenu = document.querySelector('#model-dropdown > .dropdown-menu');
        const hiddenDropdown = document.getElementById('id_model');
        console.log(hiddenDropdown.lastChild);

        if (dropdownMenu) {
            dropdownMenu.innerHTML = ''; // Более простой способ очистки
            console.log('Старые элементы очищены');
        } else {
            console.error('dropdownMenu не найден');
            reject('dropdownMenu не найден'); // Прерываем выполнение с ошибкой
            return;
        }
        modelDropdown.disable = true;
        var select = document.querySelector('[name="model"]');
        const url_api = "/catalog/api/cars/brand/"


        dropdownMenu.innerHTML += `
            <li><button type="button" onclick="setField('model', '', 'Модель авто')" class="dropdown-item">Любая</button></li>
            <li><hr class="dropdown-divider" ></li>
        `;


        fetch(`${url_api}?brand=${brand}`, {
            method: "GET",
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Сеть не сработала');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            let foundCurrentModel = false; // Флаг для проверки, была ли найдена текущая модель

            // Добавление новых моделей в dropdownMenu
            data.forEach(item => {
                dropdownMenu.innerHTML += `
                    <li><button type="button" onclick="setField('model', '${item}', '${item}')" class="dropdown-item">${item}</button></li>
                `;
                var option = document.createElement('option');
                option.value = item;
                option.text = item;
                select.add(option);

                // Проверяем, совпадает ли модель с текущим значением
                if (item === currentModelValue) {
                    foundCurrentModel = true; // Устанавливаем флаг, если текущая модель найдена
                }
            });
            modelDropdown.disabled = false;
            // Если текущее значение модели найдено в данных, устанавливаем его
            if (foundCurrentModel) {
                setField('model', currentModelValue, currentModelValue);
            } else {
                setField('model', '', "");
            }

            // Разрешаем промис, когда данные успешно обработаны
            resolve();
        })
        .catch(error => {
            console.error('Ошибка:', error);
            reject(error); // Отклоняем промис в случае ошибки
        });
    });
};
brandInput = document.getElementById('brand-input')
brandInput.addEventListener('input', function() {
    brandInput.classList.remove('font-weight-bold');
    filter = brandInput.value.toLowerCase();
    options = document.querySelectorAll('#brand-dropdown .dropdown-item');

    options.forEach(option => {
        const text = option.textContent.toLowerCase();
        option.style.display = text.includes(filter) ? 'block' : 'none';
    });
});

modelInput = document.getElementById('btn-model')
modelInput.addEventListener('input', function() {
    modelInput.classList.remove('font-weight-bold');
    filter = modelInput.value.toLowerCase();
    options = document.querySelectorAll('#model-dropdown .dropdown-item');

    options.forEach(option => {
        const text = option.textContent.toLowerCase();
        option.style.display = text.includes(filter) ? 'block' : 'none';
    });
});
    let setField = (field, value, text) => {
        var form = document.getElementById('filter-form');

        var input = document.querySelector(`[name=${field}]`);
        input.value = value;

        if (field == "brand") {
            if (text == "Любая" || text == "") {
                // Очистка select с name="model"
                var select = document.querySelector('[name="model"]');
                setField('model', "Модель авто", "");
                document.getElementById('btn-model').disabled = true;
                document.getElementById('btn-model').classList.remove('font-weight-bold');

                document.getElementById('brand-input').value = ''
                document.getElementById('brand-input').classList.remove('font-weight-bold');
            }
            else {
                document.getElementById('btn-model').disabled = false;
                fetchModels(text);

                document.getElementById('brand-input').value = text;
                document.getElementById('brand-input').classList.add('font-weight-bold');
            }
            return
        }else if(field == "sort"){
            // Отправим форму сразу если сортировка
            form.submit();
        }else if(field == "model"){
            if (text == "Любая" || text == "") {
                document.getElementById('btn-model').classList.remove('font-weight-bold');
                document.getElementById('btn-model').value = ''
            }
            else {
                document.getElementById('btn-model').classList.add('font-weight-bold');
                document.getElementById('btn-model').value = text;
            }
            return
        }

        // Обновить текст в кнопке dropdown
        var dropdown = document.getElementById(`${field}-dropdown`);
        let button = dropdown.querySelector('.catalog__filter-select--btn');
        console.log(text)
        if (text !== "Любое" && text !== "Модель авто" && text !== "Любой" && text !== "Любая" && text !== "Без сортировки" && text !== "Рейтнг") {
            button.classList.add('font-weight-bold');
        }
        else {
            if (field === "brand") { text = "Марка авто" }
            else if (field === "model") { text = "Модель авто" }
            else if (field === "color") { text = "Цвет" }
            else if (field === "transmission") { text = "Тип КПП" }
            else if (field === "drive") { text = "Привод" }
            else if (field === "millage_min") { text = "Пробег от, км" }
            else if (field === "engine_volume_min") { text = "Объем от, л" }
            else if (field === "year_min") { text = "Год от" }
            else if (field === "sort") { text = "Сортировка" }
            else if (field === "rate") { text = "Рейтнг" }
            else if (field === "millage_max" || field === "engine_volume_max" || field === "year_max") { text = "до" }

            button.classList.remove('font-weight-bold');
        }
        button.textContent = text;

    };
    document.addEventListener('DOMContentLoaded', function() {


    function getUrlParameter(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Функция для обновления текста кнопки на основе скрытого поля
    function updateButtonText(hiddenField, button, value, flag) {
        const value_ = getUrlParameter(value);

        if (value_) {
            const option = Array.from(hiddenField.options).find(opt => opt.value === value_);
            if (option) {
                option.selected = true;
                select_text = option.text
            }
            if(button){
                button.textContent = select_text;
                button.classList.add('font-weight-bold');
            }


            // Проверяем, изменилось ли поле 'brand'
            if (hiddenField.id === 'id_brand') {
                const hiddenIndex = document.getElementById('id_model').value;
                const hiddenModel = document.getElementById('id_model');
                const button_model = document.getElementById('btn-model');
                document.getElementById('brand-input').value = value_;
                document.getElementById('brand-input').classList.add('font-weight-bold');
                button_model.disabled = false;
                // Сохраняем текущее значение текстовой кнопки модели
                const currentModelText = button_model.textContent;

                // Пытаемся получить новые модели
                fetchModels(hiddenField.value)
                    .then(() => {
                        // Удаляем строку с обновлением текста до получения данных
                        // Обновляем текст кнопки модели только если оно не было изменено
                        if (hiddenIndex) {
                            hiddenModel.value = hiddenIndex
                        }
                        if (hiddenModel.value) {
                            console.log()
                            updateButtonText(hiddenModel, button_model, "", true);
                        } else {
                            button_model.textContent = currentModelText; // Сохраняем предыдущее значение
                        }
                        console.log('yes');
                    })
                    .catch(error => {
                        console.error('Ошибка при получении моделей:', error);
                        // Можно добавить дополнительную логику обработки ошибок, если необходимо
                    });
                }
            }else if(hiddenField.id === 'id_model'){
                model_hidden = document.getElementById('id_model')
                for (let opt of model_hidden.options) {

                    if (opt.value === value_) {
                        opt.selected = true;
                        select_text = opt.text;
                    }
                }
            }else{
                document.getElementById('btn-model').disabled = true;
                hiddenField.selectedIndex = 0;
            }

            if(flag){
                document.getElementById('btn-model').disabled = false;
            }

    }

    const hiddenFields = [
        {hidden: document.getElementById('id_brand'), button: document.getElementById('btn'), value: 'brand'},
        {hidden: document.getElementById('id_model'), button: document.getElementById('btn-model'), value:'model'},
        {hidden: document.getElementById('id_drive'), button: document.getElementById('btn-drive'), value: 'drive'},
        {hidden: document.getElementById('id_engine_volume_min'), button: document.getElementById('btn-volume'), value: 'engine_volume_min'},
        {hidden: document.getElementById('id_engine_volume_max'), button: document.getElementById('btn-volume2'), value: 'engine_volume_max'},
        {hidden: document.getElementById('id_year_min'), button: document.getElementById('btn-year1'), value: 'year_min'},
        {hidden: document.getElementById('id_year_max'), button: document.getElementById('btn-year2'), value: 'year_max'},
        {hidden: document.getElementById('id_mileage_min'), button: document.getElementById('btn-mileage1'), value: 'mileage_min'},
        {hidden: document.getElementById('id_mileage_max'), button: document.getElementById('btn-mileage2'), value: 'mileage_max'},
        {hidden: document.getElementById('id_transmission'), button: document.getElementById('btn-transmission'), value: 'transmission'},
        {hidden: document.getElementById('id_color'), button: document.getElementById('btn-color'), value: 'color'},
        {hidden: document.getElementById('id_sort'), button: document.getElementById('btn-sort'), value: 'sort'}
    ];

    // Обработчики для всех скрытых полей
    hiddenFields.forEach(({hidden, button, value}) => {
        hidden.addEventListener('change', function() {
            updateButtonText(hidden, button, value);
        });
        updateButtonText(hidden, button, value);
    });

    console.log('done');
});
</script>
<script src="/static/js/min_js/form.js"></script>
<script>
    document.querySelector('.catalog__filter-parametrs').addEventListener('click', () => {
        document.querySelector('.catalog-filter').style.display = "block"
    })
    document.querySelector('.catalog-filter-header--close').addEventListener('click', () => {
        document.querySelector('.catalog-filter').style.display = "none"
    })
</script>


  <div id="notification-container" style="position: fixed; top: 20px; right: 20px; z-index: 1000;"></div>
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <form method = "POST" id="feedback" class="modal__form">
                <button type="button" id="close" class="btn-close btn-close-mobile" data-bs-dismiss="modal" aria-label="Close"></button>
                <input type="hidden" name="csrfmiddlewaretoken" value="nmYbpYUrkLKqIKgHk95fgZL8NmZ5PZ57zvd664qUhN1vt9JahAPC4d8jvJQFgLA8">
                <button type="button" class="btn-close btn-close-desktop" data-bs-dismiss="modal" aria-label="Close"></button>
                <h3 class="modal__form-title">Оставить заявку</h3>
                <p class="modal__form-text">Оставьте свою заявку и наш менеджер свяжется с Вами для уточнения деталей.</p>
                <div class="modal__form-section modal__form-section--flex">
                    <div class="modal__form-input--box">
                        <p class="modal__form-text">Имя</p>
                        <input type="text" name="name" required id="" placeholder="Имя" class="modal__form-input" maxlength="50">

                    </div>
                    <div class="modal__form-input--box">
                        <p class="modal__form-text">Телефон (Обязательно)</p>
                        <input type="tel" name="number" id="" placeholder="+7 " class="modal__form-input modal__form-input--tel" required pattern="^\+7 \(\d{3}\) \d{3} \d{2} \d{2}$" title="+7 (XXX) XXX XX XX" maxlength="20">

                    </div>

                </div>
                <div class="modal__form-section">
                    <div class="modal__form-input--box">
                        <p class="modal__form-text">Уточните свой вопрос</p>
                        <textarea name="message" cols="40" rows="10" placeholder="Введите текст сообщения" class="modal__form-input modal__form-textarea" id="">
</textarea>

                    </div>

                </div>
                <div class="modal__form-section modal__form-section--bottom">
                    <div class="modal__form-input--box modal__form-input--box-flex">
                        <input class="modal__form-checkbox" type="checkbox" id="check-modal" name="check" value="yes" checked>
                        <label class="custom--checkbox" for="check-modal"></label>
                        <p class="modal__form-text">С <a href="/media/confidentiality/%D0%9F%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8.pdf" class="blue--link" download>правилами политики<br>конфиденциальности</a> ознакомлен</p>
                    </div>
                    <div class="modal__form-input--box modal__form-btn--box">
                        <button id="submit" type="submit" class="modal__form-btn">Отправить</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
</body>



<script src="/static/vendor/Imask.js"></script>
<script src="/static/js/min_js/mask.js"></script>
<script src="/static/js/min_js/header.js"></script>
<script src="/static/js/min_js/form.js"></script>


</html>


